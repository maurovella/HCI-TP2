var _0x5730=['typeId','then','actions','events','type','roomId','fromDto','rooms','room','map','join','config','general','dbName','loading\x20device\x20database\x20[','debug','ensureIndex','log','error','exports','devices','devices.db','models','toDto','context','device','name','update','remove','find','inflateDtos','findOne','inflateDto','retrieveById'];(function(_0x5c5bac,_0x52b923){var _0x1d7612=function(_0x11d664){while(--_0x11d664){_0x5c5bac['push'](_0x5c5bac['shift']());}};_0x1d7612(++_0x52b923);}(_0x5730,0x9b));var _0x1efc=function(_0x2a1c73,_0x4c24e1){_0x2a1c73=_0x2a1c73-0x0;var _0x333544=_0x5730[_0x2a1c73];return _0x333544;};'use strict';var Datastore=require('nedb');var Path=require('path');module[_0x1efc('0x0')]={'initialize':function(_0x521d1e,_0x4d29b1){_0x521d1e[_0x1efc('0x1')]={'dbName':_0x1efc('0x2'),'create':function(_0x465632){return new Promise((_0x48f034,_0x451f06)=>{var _0x4ddc07=_0x521d1e[_0x1efc('0x3')]['device'][_0x1efc('0x4')](_0x465632);_0x521d1e['db'][_0x1efc('0x1')]['insert'](_0x4ddc07,(_0x2add54,_0x114930)=>{if(_0x2add54){_0x2add54[_0x1efc('0x5')]={'entity':{'type':_0x1efc('0x6'),'id':_0x4ddc07[_0x1efc('0x7')]}};_0x451f06(_0x2add54);}else{_0x48f034(_0x521d1e['devices']['inflateDto'](_0x114930));}});});},'update':function(_0xbcc6f8){return new Promise((_0x3ac052,_0x3a0fce)=>{var _0x3cb842=_0x521d1e[_0x1efc('0x3')][_0x1efc('0x6')]['toDto'](_0xbcc6f8);_0x521d1e['db'][_0x1efc('0x1')][_0x1efc('0x8')]({'_id':_0x3cb842['_id']},_0x3cb842,{},(_0x17fec7,_0x3ff3da)=>{if(_0x17fec7){_0x17fec7['context']={'entity':{'type':_0x1efc('0x6'),'id':_0x3cb842['name']}};_0x3a0fce(_0x17fec7);}else{_0x3ac052(_0x3ff3da==0x1);}});});},'delete':function(_0x1350e1){return new Promise((_0x55e655,_0x436d75)=>{_0x521d1e['db'][_0x1efc('0x1')][_0x1efc('0x9')]({'_id':_0x1350e1},{},(_0x5e8578,_0x188432)=>{if(_0x5e8578){_0x436d75(_0x5e8578);}else{_0x55e655(_0x188432==0x1);}});});},'retrieveAll':function(){return new Promise((_0x25b6f0,_0x4d52c1)=>{_0x521d1e['db']['devices'][_0x1efc('0xa')]({},(_0x4a6451,_0x4f5c63)=>{if(_0x4a6451){_0x4d52c1(_0x4a6451);}else{_0x25b6f0(_0x25b6f0(_0x521d1e['devices']['inflateDtos'](_0x4f5c63)));}});});},'retrieveByRoomId':function(_0x4d6581){return new Promise((_0x5bc4a4,_0x3e7948)=>{_0x521d1e['db'][_0x1efc('0x1')][_0x1efc('0xa')]({'roomId':_0x4d6581},(_0x287687,_0x26093a)=>{if(_0x287687){_0x3e7948(_0x287687);}else{_0x5bc4a4(_0x5bc4a4(_0x521d1e[_0x1efc('0x1')]['inflateDtos'](_0x26093a)));}});});},'retrieveByDeviceTypeId':function(_0x45f217){return new Promise((_0x3730eb,_0x4f65be)=>{_0x521d1e['db'][_0x1efc('0x1')][_0x1efc('0xa')]({'typeId':_0x45f217},(_0x41aee8,_0x381c09)=>{if(_0x41aee8){_0x4f65be(_0x41aee8);}else{_0x3730eb(_0x3730eb(_0x521d1e[_0x1efc('0x1')][_0x1efc('0xb')](_0x381c09)));}});});},'retrieveById':function(_0x3256b7){return new Promise((_0x38e752,_0x2abe8f)=>{_0x521d1e['db'][_0x1efc('0x1')][_0x1efc('0xc')]({'_id':_0x3256b7},(_0x3a9014,_0x25b4a1)=>{if(_0x3a9014){_0x2abe8f(_0x3a9014);}else{_0x38e752(_0x521d1e[_0x1efc('0x1')][_0x1efc('0xd')](_0x25b4a1));}});});},'inflateDto':function(_0x22efdf){return new Promise((_0x1e7e6f,_0x20f224)=>{if(!_0x22efdf)_0x1e7e6f(null);else{_0x521d1e['deviceTypes'][_0x1efc('0xe')](_0x22efdf[_0x1efc('0xf')])[_0x1efc('0x10')](_0x2d20d0=>{delete _0x2d20d0[_0x1efc('0x11')];delete _0x2d20d0[_0x1efc('0x12')];_0x22efdf[_0x1efc('0x13')]=_0x2d20d0;delete _0x22efdf[_0x1efc('0xf')];if(!_0x22efdf[_0x1efc('0x14')])_0x1e7e6f(_0x521d1e['models'][_0x1efc('0x6')][_0x1efc('0x15')](_0x22efdf));else{_0x521d1e[_0x1efc('0x16')]['retrieveById'](_0x22efdf['roomId'])['then'](_0x14a51f=>{if(_0x14a51f){delete _0x14a51f['meta'];_0x22efdf[_0x1efc('0x17')]=_0x14a51f;delete _0x22efdf['roomId'];}_0x1e7e6f(_0x521d1e[_0x1efc('0x3')][_0x1efc('0x6')][_0x1efc('0x15')](_0x22efdf));});}});}});},'inflateDtos':function(_0x4862c1){return new Promise((_0x5ab0b7,_0x6b17a4)=>{var _0x1bf288=_0x4862c1[_0x1efc('0x18')](_0x1e27df=>{return _0x521d1e[_0x1efc('0x1')][_0x1efc('0xd')](_0x1e27df);});Promise['all'](_0x1bf288)[_0x1efc('0x10')](_0x1bf380=>{_0x5ab0b7(_0x1bf380);});});}};return _0x4d29b1();},'start':function(_0x1ffe72,_0x3b217d){var _0x599f0f=Path[_0x1efc('0x19')](_0x1ffe72[_0x1efc('0x1a')][_0x1efc('0x1b')]['paths']['db'][0x0],_0x1ffe72['devices'][_0x1efc('0x1c')]);_0x1ffe72['log'](_0x1efc('0x1d')+_0x599f0f+']...',_0x1efc('0x1e'));_0x1ffe72['db']=_0x1ffe72['db']||{};_0x1ffe72['db'][_0x1efc('0x1')]=new Datastore({'filename':_0x599f0f,'autoload':!![]});_0x1ffe72['db']['devices'][_0x1efc('0x1f')]({'fieldName':'name','unique':!![]},_0x450869=>{if(_0x450869)_0x1ffe72[_0x1efc('0x20')](_0x450869,_0x1efc('0x21'));});_0x1ffe72[_0x1efc('0x20')]('device\x20database\x20loaded','info');return _0x3b217d();}};